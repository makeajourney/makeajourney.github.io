---
title: "AOP"
layout: post
---

# AOP

Aspect Oriented Programming (관점 지향 프로그래밍)  

transaction, logging, security와 관련된 코드들을 분리하여 관리.  


## proxy, target, real subject

Proxy(프록시) : 자신이 클라이언트가 사용하려고 하는 실제 대상인 것처럼 위장해서 클라이언트의 요청을 받아주는 것을 대리자, 대리인과 같은 역할을 한다고 해서 프록시라고 부른다.  
Target(타깃), Real subject(실체) : 프록시를 통해 최종적으로 요청을 위임받아 처리하는 실제 오브젝트.  

프록시는 타깃과 같은 인터페이스를 구현한다.  
프록시가 타깃을 제어할 수 있는 위치에 있다.  

### 데코레이터 패턴

타깃에 부가적인 기능을 런타임에 다양하게 부여해주기 위해 프록시를 사용하는 패턴.  
데코레이터 패턴에서는 같은 인터페이스를 구현한 타겟과 여러개의 프록시를 사용할 수 있다. 프록시가 여러개인 만큼 순서를 정해서 단계적으로 위임하는 구조로 만든다.  

데코레이터 패턴의 대표적인 예 : InputStream, OutputStream 구현 클래스  

~~~java
InputStream is = new BufferedInputStream(new FileInputStream("a.txt"));
~~~

InputStream이라는 인터페이스를 구현한 타깃인 FileInputStream에 버퍼 읽기 기능을 제공해주는 BufferedInputStream이라는 데코레이터를 적용한 예이다.  

### 프록시 패턴

프록시를 사용하는 방법 중에서 타깃에 대한 접근 방법을 제어하려는 목적을 가진 경우.  
타깃의 기능 자체에는 관여하지 않으면서 접근하는 방법을 제어해주는 프록시를 이용.  

- 타깃 오브젝트를 생성하기가 복잡하거나 당장 필요하지 않지만 타깃 오브젝트에 대한 레퍼런스가 미리 필요할 때 프록시 패턴을 적용하면 된다. 클라이언트에게 타깃에 대한 레퍼런스를 넘겨야 하는데, 실제 타깃 오브젝트를 만드는 대신 프록시를 넘겨준다. 그리고 프록시의 메소드를 통해 타깃을 사용하려고 시도하면, 그 때 프록시가 타깃 오브젝트를 생성하고 요청을 위임한다.  
- 다른 서버에 존재하는 오브젝트를 사용해야 할 때, 원격 오브젝트에 대한 프록시를 만들어두고, 클라이언트는 로컬에 존재하는 오브젝트를 쓰는 것 처럼 프록시를 사용하게 할 수 있다. 프록시는 클라이언트의 요청을 받으면 네트워크를 통해 원격의 오브젝트를 실행하고 결과를 받아서 클라이언트에게 돌려준다.  
- 특별한 상황에서 타깃에 대한 접근권한을 제어하기 위해 프록시 패턴을 사용할 수 있다. 수정가능한 오브젝트를, 특정 레이어로 넘어가면 읽기전용으로만 동작하게 강제해야 하는 경우, 오브젝트의 프록시를 만들어서 사용할 수 있다. 프록시의 특정 메소드를 사용하려고 하면 접근이 불가능하다고 예외를 발생시키면 된다.   

## 다이나믹 프록시

다이나믹 프록시는 리플렉션 기능을 이용해서 프록시를 만들어준다.  
다이나믹 프록시는 프록시 팩토리에 의해 런타임 시 다이나믹하게 만들어지는 오브젝트다. 다이나믹 프록시 오브젝트는 타깃의 인터페이스와 같은 타입으로 만들어진다.  
클라이언트는 다이나믹 프록시 오브젝트를 타깃 인터페이스를 통해 사용할 수 있다. 프록시 팩토리에게 인터페이스 정보만 제공해주면 해당 인터페이스를 구현한 클래스의 오브젝트를 자동으로 만들어준다.  
프록시로서 필요한 부가기능 제공을 위해 프록시 오브젝트와 독립적으로 InvocationHandler 인터페이스를 구현한다.  

~~~java
public Object invoke(Object proxy, Method method, Object[] args)
~~~
